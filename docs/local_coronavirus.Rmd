---
title: "Local Coronavirus Tracker"
author: "Doug McNeall"
contact: "dougmcneall@gmail.com @dougmcneall"
date: "2020-07-02"      
output: html_document   
---

## WARNING 2020-06-30
Today (30th June 2020) the [FT reported](https://www.ft.com/content/301c847c-a317-4950-a75b-8e66933d423a) that the "Pillar 1" (hospital testing) data used to compile these graphs currently misses the vast majority of new cases. "Pillar 2" (commercial labs and home testing) captures many more of the recent cases, such as the recent outbreak in Leicester. This was not the case when I first built this tracker a couple of months ago.

It seems that hospital cases are no longer proportional to our best estimates of new local cases. I would therefore advise NOT to use the data on this page as an indication of recent coronavirus trends.


## Introduction
Note these are lab confirmed cases only - the real number of cases will be higher, and the numbers for a recent day could be revised upwards at a later date. In particular, the "about the data" link suggests that data older than 5 days can be considered complete.

Data from <https://coronavirus.data.gov.uk/>  
About the data <https://coronavirus.data.gov.uk/about>  
Data file <https://coronavirus.data.gov.uk/downloads/csv/coronavirus-cases_latest.csv>  
Code to create this page <https://github.com/dougmcneall/covid/blob/master/docs/local_coronavirus.Rmd>

Contact: dougmcneall@gmail.com

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include=FALSE}
dat <- read.csv('https://coronavirus.data.gov.uk/downloads/csv/coronavirus-cases_latest.csv')
weekly <- read.csv('../data/weekly_uk_covid19_cases_2020-07-02.csv')
```


```{r, include=FALSE}

plotLocalCases <- function(area = 'Devon', dat, col = 'skyblue2', ...){
        # 'area' should be a string that names an area of interest
        
        localData <- dat[dat[,'Area.name']==area, ]
        
        
        da = seq(from = min(as.Date(localData[, 'Specimen.date'])), to = max(as.Date(localData[, 'Specimen.date'])), by = 7)

        
        par(las = 1, mar = c(2.5,4,5,1))
        plot(as.Date(localData[, 'Specimen.date']), localData[, 'Daily.lab.confirmed.cases'],
             xlab = '', ylab = 'cases', main = paste0('Daily lab-confirmed Coronavirus cases in ', area),
             type = 'h', lwd = 5, col = col, bty = 'n', axes = FALSE, ...)
        grid()
        
        axis.Date(1,at=da,labels=format(da,"%d %b"),las=1)
        axis(2)
}

```


## Devon and Exeter  
```{r, echo=FALSE, fig.width=12, fig.height = 4 }

# Hard code the double plot here for the minute
# isolate Exeter cases
exe <- dat[dat[,'Area.name']=='Exeter',]
devon <- dat[dat[,'Area.name']=='Devon',]

devon_weekly <- weekly[weekly[,'area_name']=='Devon',]

par(las = 1, mar = c(2.5,4,5,1))
plot(as.Date(devon[, 'Specimen.date']), devon[, 'Daily.lab.confirmed.cases'],
     xlab = '', ylab = 'cases', main = '',
     type = 'h', lwd = 5, col = 'skyblue2', bty = 'n', axes = FALSE)
grid()


da = seq(from = min(as.Date(devon[, 'Specimen.date'])), to = max(as.Date(devon[, 'Specimen.date'])), by = 7)
axis.Date(1,at=da,labels=format(da,"%d %b"),las=1)
axis(2)

points(as.Date(exe[, 'Specimen.date']), exe[, 'Daily.lab.confirmed.cases'],
     xlab = 'Date', ylab = 'cases', main = 'Daily lab confirmed Coronavirus cases in Devon & Exeter',
     type = 'h', col = 'tomato2', lwd = 5)
legend('topleft', legend = c('Devon', 'Exeter'), col = c('skyblue2', 'tomato2'), lty = 'solid', lwd=5, bty = 'n')
mtext(text = 'Pillar 1: Daily lab-confirmed Coronavirus cases in Devon (& Exeter)', side = 3, line = .5, adj = 0, cex = 1.5)
mtext(text = paste('Pillar 2:', devon_weekly$dates, '\n weekly cases:', devon_weekly$cases, '\n per 100k:',devon_weekly$cases_per_100k), side = 3, adj = 1, cex = 1.5)

```


## Dorset
```{r, echo=FALSE, fig.width=12, fig.height = 4 }

plotLocalCases(area = 'Dorset', dat = dat)

```


## South West
```{r, echo=FALSE, fig.width=12, fig.height = 4 }

plotLocalCases(area = 'South West', dat = dat)

```

## Milton Keynes 
```{r, echo=FALSE, fig.width=12, fig.height = 4 }

plotLocalCases(area = 'Milton Keynes', dat = dat)

```


## Hackney
```{r, echo=FALSE, fig.width=12, fig.height = 4 }

plotLocalCases(area = 'Hackney', dat = dat)

```


## Reading
```{r, echo=FALSE, fig.width=12, fig.height = 4 }

plotLocalCases(area = 'Reading', dat = dat)

```

## Leicester
```{r, echo=FALSE, fig.width=12, fig.height = 4 }

plotLocalCases(area = 'Leicester', dat = dat)

```


```{r, echo=FALSE, fig.width=12, fig.height = 4 }

plotLocalCases(area = 'England', dat = dat)

```

```{r, echo=FALSE, fig.width=12, fig.height = 4 }

plotLocalCases(area = 'North West', dat = dat)

```

```{r, echo=FALSE, fig.width=12, fig.height = 4 }

plotLocalCases(area = 'North East', dat = dat)

```

```{r, echo=FALSE, fig.width=12, fig.height = 4 }

plotLocalCases(area = 'South East', dat = dat)

```


```{r, include=FALSE}

plotLocalRates <- function(area = 'Devon', dat, col = 'skyblue2', ...){
        # 'area' should be a string that names an area of interest
        
        localData <- dat[dat[,'Area.name']==area, ]
        
        da = seq(from = min(as.Date(localData[, 'Specimen.date'])), to = max(as.Date(localData[, 'Specimen.date'])), by = 7)

        
        par(las = 1, mar = c(2.5,4,4,1))
        plot(as.Date(localData[, 'Specimen.date']), localData[, 'Cumulative.lab.confirmed.cases.rate'],
             xlab = '', ylab = 'cases per 100 000 population', main = paste0('Cumulative lab confirmed cases rate in ', area),
             type = 'h', lwd = 5, col = col, bty = 'n', axes = FALSE, ...)
        grid()
        
        axis.Date(1,at=da,labels=format(da,"%d %b"),las=1)
        axis(2)
}

plotLocalRates(area = 'Devon', dat = dat)

```


```{r, fig.width=10, fig.height=4, include=FALSE, echo=FALSE}

par(las = 1)
plot(as.Date(devon[, 'Specimen.date']), devon[, 'Daily.lab.confirmed.cases'], type = 'n', axes = FALSE,
     xlab = 'Date', ylab = 'Daily lab confirmed cases', main = 'Daily lab confirmed Coronavirus cases in Devon & Exeter')
grid()
axis.Date(1, devon[, 'Specimen.date'])
axis(2)
lines(as.Date(devon[, 'Specimen.date']), devon[, 'Daily.lab.confirmed.cases'], type = 'o', pch = 20, col = 'black', lwd = 1.5)
lines(as.Date(exe[, 'Specimen.date']), exe[, 'Daily.lab.confirmed.cases'], type = 'o', pch = 20, col = 'blue', lwd = 1.5)
legend('topleft', legend = c('Devon', 'Exeter'), col = c('black', 'blue'), lty = 'solid', lwd = 1.5, pch = 20)
```



